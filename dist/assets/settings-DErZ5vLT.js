import"./modulepreload-polyfill-YP0FEG5d.js";import{a as e,f as t,b as r}from"./admin-app-shell-Cas55neG.js";import{b as s,s as n,a as o,c as a}from"./shared-utils-DEXrBstL.js";import{doc as i,setDoc as c}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";import{updateProfile as l}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";import"https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";const m={profileForm:document.getElementById("profile-settings-form"),profileName:document.getElementById("profile-name"),profileEmail:document.getElementById("profile-email"),saveProfileBtn:document.getElementById("save-profile-btn"),preferencesForm:document.getElementById("preferences-form"),themeToggleSwitch:document.getElementById("theme-toggle-switch"),savePreferencesBtn:document.getElementById("save-preferences-btn"),deleteAccountBtn:document.getElementById("delete-account-btn"),sidebarUserName:document.querySelector(".user-name-display"),sidebarUserEmail:document.getElementById("userEmail"),allUserAvatars:document.querySelectorAll(".user-avatar-display")};!function(t){const r=()=>{e.currentUser?(console.log("Settings Logic: Auth is ready."),t(e.currentUser)):(console.log("Settings logic waiting for authentication..."),requestAnimationFrame(r))};requestAnimationFrame(r)}(u=>{var d;!async function(e){e.email&&(m.profileEmail.value=e.email);m.profileName.value=e.displayName||"New User";const t=e.theme||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");m.themeToggleSwitch.checked="dark"===t}(u),d=u.uid,m.profileForm.addEventListener("submit",a=>async function(a,u){a.preventDefault(),s(m.saveProfileBtn,!0);const d=n(m.profileName.value.trim());if(d.length<2)return o("Error","Name must be at least 2 characters.","error"),void s(m.saveProfileBtn,!1);try{const s=i(t,"user_data",u,"profile","settings");await c(s,{fullName:d},{merge:!0}),r.currentUser&&await l(r.currentUser,{displayName:d}),e.currentUser.displayName=d,e.currentUser.fullName=d;const n=`https://ui-avatars.com/api/?name=${encodeURIComponent(d)}&background=4361ee&color=fff&size=40`;e.currentUser.photoURL=n,m.sidebarUserName&&(m.sidebarUserName.textContent=d),m.allUserAvatars.forEach(e=>e.src=n),o("Success","Profile updated successfully!","success")}catch(f){console.error("Error saving profile:",f),o("Error","Could not save profile.","error")}finally{s(m.saveProfileBtn,!1)}}(a,d)),m.preferencesForm.addEventListener("submit",r=>async function(r,n){r.preventDefault(),s(m.savePreferencesBtn,!0);const a=m.themeToggleSwitch.checked?"dark":"light";try{const r=i(t,"user_data",n,"profile","settings");await c(r,{theme:a},{merge:!0}),e.currentUser.theme=a,localStorage.setItem("theme",a),document.documentElement.setAttribute("data-theme",a),document.documentElement.classList.toggle("dark","dark"===a);const s=document.querySelector("#themeToggle i");s&&(s.className="dark"===a?"bi bi-sun-fill":"bi bi-moon-fill"),o("Success","Preferences saved!","success")}catch(l){console.error("Error saving preferences:",l),o("Error","Could not save preferences.","error")}finally{s(m.savePreferencesBtn,!1)}}(r,d)),m.deleteAccountBtn.addEventListener("click",()=>function(e){a("Delete Your Account?","This is permanent. All your devices, geofences, and settings will be erased. <strong>This action cannot be undone.</strong> Are you absolutely sure?","danger",async()=>{console.log(`User ${e} confirmed account deletion. Triggering Cloud Function (demo)...`),o("Request Sent","Account deletion request sent. This must be handled by a secure server function.","info")},null,{isHTML:!0})}(d))});
