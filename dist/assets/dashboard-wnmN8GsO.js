import"./modulepreload-polyfill-YP0FEG5d.js";import{f as t}from"./admin-app-shell-Cas55neG.js";import"./map-tiles-D1fw3GxV.js";import{a as e}from"./shared-utils-DEXrBstL.js";import{collection as s,onSnapshot as r,query as n,where as a,collectionGroup as i,getDocs as o,orderBy as c,limit as d}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";const l={statTotalUsers:document.getElementById("stat-total-users"),statTotalDevices:document.getElementById("stat-total-devices"),statOpenTickets:document.getElementById("stat-open-tickets"),statSecurityAlerts:document.getElementById("stat-security-alerts"),recentTicketsList:document.getElementById("recent-tickets-list"),ticketsEmptyState:document.getElementById("tickets-empty-state"),recentUsersList:document.getElementById("recent-users-list"),usersEmptyState:document.getElementById("users-empty-state")};!function(t){const e=()=>{window.currentUserIsAdmin?(console.log("Admin Dashboard Logic: Auth is ready."),t(window.currentUserId)):(console.log("Admin Dashboard logic waiting for admin authentication..."),requestAnimationFrame(e))};requestAnimationFrame(e)}(m=>{!function(){const c=s(t,"user_data");r(c,t=>{l.statTotalUsers.textContent=t.size},t=>{console.error("Error listening for total users:",t),l.statTotalUsers.textContent="N/A"});const d=s(t,"support_tickets"),m=n(d,a("status","==","new"));r(m,t=>{l.statOpenTickets.textContent=t.size},t=>{console.error("Error listening for open tickets:",t),l.statOpenTickets.textContent="N/A"});const p=i(t,"devices");o(p).then(t=>{l.statTotalDevices.textContent=t.size}).catch(t=>{console.error("Error fetching total devices:",t),l.statTotalDevices.textContent="N/A",e("Performance Warning","Device count is simulated. Use Cloud Function in production.","info")});const u=n(i(t,"devices"),a("status","==","lost"));r(u,t=>{l.statSecurityAlerts.textContent=t.size},t=>{console.error("Error listening for security alerts:",t),l.statSecurityAlerts.textContent="N/A"})}(),function(){const e=s(t,"support_tickets"),a=n(e,c("createdAt","desc"),d(5));r(a,t=>{if(t.empty)return l.recentTicketsList.innerHTML="",l.recentTicketsList.appendChild(l.ticketsEmptyState),void(l.ticketsEmptyState.style.display="table-row");l.recentTicketsList.innerHTML="",l.ticketsEmptyState.style.display="none",t.docs.forEach(t=>{const e=t.data(),s=document.createElement("tr");s.className="table-clickable-row",s.dataset.id=t.id;const r="new"===e.status?"badge-warning":"badge-success",n=e.status.charAt(0).toUpperCase()+e.status.slice(1),a=e.createdAt?.toDate?e.createdAt.toDate().toLocaleDateString():"N/A";s.innerHTML=`\n                <td>\n                    <div class="font-medium text-text-primary dark:text-dark-text-primary">${e.fullName}</div>\n                    <div class="text-xs text-text-secondary dark:text-dark-text-secondary">${e.email}</div>\n                </td>\n                <td class="text-text-secondary dark:text-dark-text-secondary">${e.subject}</td>\n                <td><span class"badge ${r}">${n}</span></td>\n                <td class="text-text-secondary dark:text-dark-text-secondary">${a}</td>\n            `,l.recentTicketsList.appendChild(s)})},t=>{console.error("Error listening for recent tickets:",t),l.recentTicketsList.innerHTML="",l.recentTicketsList.appendChild(l.ticketsEmptyState),l.ticketsEmptyState.style.display="table-row"})}(),function(){const e=s(t,"user_data"),a=n(e,d(5));r(a,e=>{if(e.empty)return l.recentUsersList.innerHTML="",l.recentUsersList.appendChild(l.usersEmptyState),void(l.usersEmptyState.style.display="block");l.recentUsersList.innerHTML="",l.usersEmptyState.style.display="none",e.docs.forEach(async e=>{const s=e.id;let r="New User";try{const e=doc(t,"user_data",s,"profile","settings"),n=await getDoc(e);n.exists()&&n.data().fullName&&(r=n.data().fullName)}catch(i){console.warn("Could not fetch profile for user:",s)}const n=document.createElement("div");n.className="flex items-center gap-3 p-4 table-clickable-row",n.dataset.id=s;const a=`https://ui-avatars.com/api/?name=${encodeURIComponent(r)}&background=4361ee&color=fff&size=40`;n.innerHTML=`\n                <img src="${a}" alt="${r}" class="w-10 h-10 rounded-full flex-shrink-0">\n                <div class="flex-1 overflow-hidden">\n                    <div class="font-medium text-text-primary dark:text-dark-text-primary truncate">${r}</div>\n                    <div class="text-sm text-text-secondary dark:text-dark-text-secondary truncate">${s}</div>\n                </div>\n                <i class="bi bi-chevron-right text-text-secondary dark:text-dark-text-secondary"></i>\n            `,l.recentUsersList.appendChild(n)})},t=>{console.error("Error listening for recent users:",t),l.recentUsersList.innerHTML="",l.recentUsersList.appendChild(l.usersEmptyState),l.usersEmptyState.style.display="block"})}()});
