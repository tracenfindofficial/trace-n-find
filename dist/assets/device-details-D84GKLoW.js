import"./modulepreload-polyfill-YP0FEG5d.js";import{f as e}from"./app-shell-CtSII-jN.js";import{m as t}from"./map-tiles-D1fw3GxV.js";import{a as n,g as i,d as o,e as a,s,i as r}from"./shared-utils-DEXrBstL.js";import{collection as d,query as c,where as l,onSnapshot as m,doc as u,orderBy as f,limit as g}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";import"https://www.gstatic.com/firebasejs/12.6.0/firebase-storage.js";let p=null,y=null,v=null,w=null,x=null;const b={loader:document.getElementById("skeleton-loader"),content:document.getElementById("device-content"),notificationBadge:document.getElementById("notificationBadge"),headerName:document.getElementById("header-device-name"),deviceName:document.getElementById("device-name"),deviceIcon:document.getElementById("device-icon"),deviceModel:document.getElementById("device-model"),deviceStatus:document.getElementById("device-status-badge"),deviceLastSeen:document.getElementById("device-last-seen"),statBattery:document.getElementById("battery-level-text"),statStorage:document.getElementById("storage-text"),statNetwork:document.getElementById("network-type-text"),statSignal:document.getElementById("signal-strength-text"),mapContainer:document.getElementById("map"),activityList:document.getElementById("activity-timeline"),infoOS:document.getElementById("device-os"),infoCarrierStatus:document.getElementById("device-carrier-status"),infoIP:document.getElementById("device-ip"),infoCarrier:document.getElementById("device-carrier"),infoMAC:document.getElementById("device-mac"),batteryChart:document.getElementById("battery-chart"),networkChart:document.getElementById("network-chart"),storageChart:document.getElementById("storage-chart"),signalChart:document.getElementById("signal-chart")};!function(e){const n=()=>{window.currentUserId&&window.librariesLoaded&&"undefined"!=typeof google&&"undefined"!=typeof Chart&&t?e(window.currentUserId):requestAnimationFrame(n)};n()}(h=>{const C=new URLSearchParams(window.location.search);p=C.get("id"),p?(console.log(`Initializing details for device: ${p}`),function(l,p){(function(){if(!b.mapContainer)return;const e="dark"===document.documentElement.getAttribute("data-theme")?t.dark:t.light;v=new google.maps.Map(b.mapContainer,{center:{lat:2.9436,lng:101.7949},zoom:13,disableDefaultUI:!0,zoomControl:!0,styles:e}),x=new google.maps.InfoWindow,window.addEventListener("themeChanged",e=>{if(v&&t){const n="dark"===e.detail.theme?t.dark:t.light;v.setOptions({styles:n})}})})(),function(t,d){const c=u(e,"user_data",t,"devices",d);m(c,e=>{e.exists()?(y={id:e.id,...e.data()},function(e){const t=e.info||{},n=e.sim||{},d=e.security||{};b.headerName.textContent=e.name||"Unknown Device",b.deviceName.textContent=e.name||"Unknown Device",b.deviceModel.textContent=e.model||t.model||"Unknown Model";const c=i(e.status);b.deviceIcon.style.backgroundColor=`${c}20`,b.deviceIcon.style.color=c,b.deviceIcon.innerHTML=`<i class="bi ${o(e.type||t.type)}"></i>`,b.deviceStatus.textContent=e.status||"Offline",b.deviceStatus.style.color=c,b.deviceStatus.className="text-sm font-semibold uppercase px-3 py-1 rounded-full border border-current",b.deviceLastSeen.textContent=a(e.lastSeen||e.last_updated);const l=e.battery??e.battery_level??0;b.statBattery.textContent=`${l}%`,b.statStorage.textContent=e.storage||"N/A",b.statNetwork.textContent=e.network_display||e.network||"N/A";const m=e.signal_strength??e.signal??e.signal_level;if(null!=m){const e=String(m).replace(/\s?dBm/gi,"").trim();b.statSignal.textContent=`${e} dBm`}else b.statSignal.textContent="N/A";b.infoOS.textContent=e.os_version||e.os||t.os||"N/A",b.infoIP.textContent=e.ip_address||e.ip||t.ip||"N/A",b.infoMAC&&(b.infoMAC.textContent=e.mac_address||e.mac||t.mac||"N/A");const u=n.carrier||e.carrier||"Unknown Carrier";b.infoCarrier.textContent=u;const f=e.sim_status||d.sim_status||n.status||"Unknown";b.infoCarrierStatus.textContent=f,b.infoCarrierStatus.className="font-medium";const g=String(f).toLowerCase();["active","online","ready","inserted"].includes(g)?b.infoCarrierStatus.classList.add("text-success-500"):["inactive","blocked","missing","removed","absent","ejected"].includes(g)&&b.infoCarrierStatus.classList.add("text-danger-500");b.loader.style.display="none",b.content.classList.remove("hidden"),b.content.classList.add("animate-fade-in"),b.content.style.opacity="1",function(e){if(!v)return;let t,n;e.location&&(void 0!==e.location.lat?t=parseFloat(e.location.lat):void 0!==e.location.latitude&&(t=parseFloat(e.location.latitude)),void 0!==e.location.lng?n=parseFloat(e.location.lng):void 0!==e.location.longitude&&(n=parseFloat(e.location.longitude)));if("number"!=typeof t||isNaN(t)||"number"!=typeof n||isNaN(n))return;const i={lat:t,lng:n},o={online:"#10b981",found:"#10b981",offline:"#ef4444",lost:"#ef4444",warning:"#f59e0b"}[e.status]||"#64748b",d=`\n        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 80 80">\n            ${"offline"!==e.status?'\n            <circle cx="40" cy="40" r="18" fill="#4361ee" stroke="#4361ee" stroke-width="2" opacity="0.6">\n                <animate attributeName="r" from="18" to="40" dur="1.5s" repeatCount="indefinite" />\n                <animate attributeName="opacity" from="0.8" to="0" dur="1.5s" repeatCount="indefinite" />\n            </circle>\n            ':""}\n            <circle cx="40" cy="40" r="18" fill="${o}" stroke="white" stroke-width="3" />\n            <g transform="translate(28, 28)">\n                <path fill="white" d="M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"/>\n            </g>\n        </svg>`,c={url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(d),scaledSize:new google.maps.Size(48,48),anchor:new google.maps.Point(24,24)};if(w){if(w.setIcon(c),r(w,i),x.getMap()){const t=`\n                <div style="color:black">\n                    <b>${s(e.name)}</b><br>\n                    Last seen: ${a(e.lastSeen)}\n                </div>\n            `;x.setContent(t)}}else w=new google.maps.Marker({position:i,map:v,title:e.name,icon:c,optimized:!1}),w.addListener("click",()=>{const t=`\n                <div style="color:black">\n                    <b>${s(e.name)}</b><br>\n                    Last seen: ${a(e.lastSeen)}\n                </div>\n            `;x.setContent(t),x.open(v,w)});v.setZoom(16)}(e)}(y)):n("Error","Device not found.","error")})}(l,p),function(t,n){const i=d(e,"user_data",t,"devices",n,"activity"),o=c(i,f("timestamp","desc"),g(10));m(o,e=>{!function(e){if(b.activityList.innerHTML="",0===e.length)return void(b.activityList.innerHTML='<li class="p-4 text-center text-text-secondary dark:text-dark-text-secondary">No recent activity.</li>');e.forEach(e=>{const t=document.createElement("li");t.className="flex items-center gap-3 p-4 border-b border-border-color dark:border-dark-border-color";let n="bi-info-circle-fill text-info";"security"===e.type&&(n="bi-shield-lock-fill text-danger"),"warning"===e.type&&(n="bi-exclamation-triangle-fill text-warning"),"lost-mode"===e.type&&(n="bi-exclamation-diamond-fill text-danger");let i=e.timestamp||e.time,o="Just now";if(i)if("function"==typeof i.toDate)o=a(i.toDate());else if(i instanceof Date)o=a(i);else if("string"==typeof i){const e=new Date(i);isNaN(e)||(o=a(e))}t.innerHTML=`\n            <i class="bi ${n} text-2xl"></i>\n            <div class="flex-1">\n                <p class="font-medium text-text-primary dark:text-dark-text-primary">${s(e.message)}</p>\n                <p class="text-sm text-text-secondary dark:text-dark-text-secondary">${o}</p>\n            </div>\n        `,b.activityList.appendChild(t)})}(e.docs.map(e=>({id:e.id,...e.data()})))})}(l,p)}(h,p),function(t){const n=d(e,"user_data",t,"notifications"),i=c(n,l("read","==",!1));m(i,e=>{!function(e){const t=b.notificationBadge;if(!t)return;e>0?(t.textContent=e>99?"99+":e,t.classList.remove("hidden"),t.classList.add("animate-pulse")):(t.classList.add("hidden"),t.classList.remove("animate-pulse"))}(e.size)},e=>{console.error("Error listening for unread count:",e)})}(h)):window.location.href="/app/devices.html"});
