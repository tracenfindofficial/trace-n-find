import"./modulepreload-polyfill-YP0FEG5d.js";import{f as e}from"./admin-app-shell-Cas55neG.js";import{a as t,c as s}from"./shared-utils-DEXrBstL.js";import{collection as o,query as n,orderBy as a,limit as l,onSnapshot as r,writeBatch as i}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";let c=[],d=null;const g={logsTableBody:document.getElementById("logs-table-body"),logsEmptyState:document.getElementById("logs-empty-state"),logsLoadingState:document.getElementById("logs-loading-state"),searchInput:document.getElementById("log-search-input"),levelFilter:document.getElementById("log-level-filter"),clearLogsBtn:document.getElementById("clear-logs-btn")};function m(e,t,s){g.logsTableBody.innerHTML="";const o=e.filter(e=>{const o=""===t||e.message.toLowerCase().includes(t)||e.context?.userId&&e.context.userId.toLowerCase().includes(t),n=""===s||e.level===s;return o&&n});if(0===o.length)return g.logsEmptyState.style.display="table-row",void g.logsTableBody.appendChild(g.logsEmptyState);g.logsEmptyState.style.display="none",o.forEach(e=>{const t=document.createElement("tr");t.className="animate-fade-in";const{badgeClass:s,iconClass:o}=function(e){switch(e){case"INFO":return{badgeClass:"badge-info",iconClass:"bi-info-circle-fill"};case"SECURITY":return{badgeClass:"badge-success",iconClass:"bi-shield-check"};case"WARN":return{badgeClass:"badge-warning",iconClass:"bi-exclamation-triangle-fill"};case"ERROR":return{badgeClass:"badge-danger",iconClass:"bi-x-circle-fill"};default:return{badgeClass:"badge-secondary",iconClass:"bi-question-circle"}}}(e.level),n=e.timestamp?.toDate?e.timestamp.toDate().toLocaleString():"N/A",a=e.context?.userId?`User: ${e.context.userId}`:e.context?.page||"System";t.innerHTML=`\n            \x3c!-- Level Column --\x3e\n            <td>\n                <span class="badge ${s}">\n                    <i class"bi ${o}"></i>\n                    ${e.level}\n                </span>\n            </td>\n            \x3c!-- Timestamp Column --\x3e\n            <td class="text-sm text-text-secondary dark:text-dark-text-secondary">${n}</td>\n            \x3c!-- Event Column --\x3e\n            <td>\n                <div class="log-message text-text-primary dark:text-dark-text-primary">${e.message}</div>\n            </td>\n            \x3c!-- Context Column --\x3e\n            <td class="text-sm text-text-secondary dark:text-dark-text-secondary font-mono">${a}</td>\n        `,g.logsTableBody.appendChild(t)})}function u(e){e?(g.logsTableBody.innerHTML="",g.logsLoadingState.style.display="table-row",g.logsEmptyState.style.display="none"):g.logsLoadingState.style.display="none"}function y(){const o=c;0!==o.length?s(!0,"Clear Displayed Logs?",`Are you sure you want to delete the <strong>${o.length}</strong> currently displayed logs? This cannot be undone.`,"Clear Logs","btn-danger",async()=>{const s=i(e);o.forEach(t=>{const o=doc(e,"system_logs",t.id);s.delete(o)});try{await s.commit(),t("Success","Logs cleared successfully.","success")}catch(n){console.error("Error clearing logs:",n),t("Error","Could not clear logs.","error")}}):t("No Logs","There are no logs to clear.","info")}!function(e){const t=()=>{window.currentUserIsAdmin?(console.log("System Logs Logic: Auth is ready."),e(window.currentUserId)):(console.log("System Logs logic waiting for admin authentication..."),requestAnimationFrame(t))};requestAnimationFrame(t)}(s=>{!function(){u(!0);const s=o(e,"system_logs"),i=n(s,a("timestamp","desc"),l(100));d&&d();d=r(i,e=>{u(!1),c=e.docs.map(e=>({id:e.id,...e.data()})),m(c,g.searchInput.value.toLowerCase(),g.levelFilter.value)},e=>{console.error("Error listening for logs:",e),t("Error","Could not load system logs.","error"),u(!1),g.logsEmptyState.style.display="table-row"})}(),function(){const e=()=>m(c,g.searchInput.value.toLowerCase(),g.levelFilter.value);g.searchInput.addEventListener("input",e),g.levelFilter.addEventListener("change",e),g.clearLogsBtn.addEventListener("click",y)}()});
