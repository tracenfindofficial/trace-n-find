import{initializeApp as e}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";import{getAuth as t,onAuthStateChanged as a,signOut as n}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";import{getFirestore as i,doc as o,getDoc as r}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";const s=e({apiKey:"AIzaSyAokTU8XIKQcaFv9RBVWMs_8iGEcni6sY4",authDomain:"trace-n--find.firebaseapp.com",projectId:"trace-n--find",storageBucket:"trace-n--find.firebasestorage.app",messagingSenderId:"1000921948484",appId:"1:1000921948484:web:92d821bd2cf4f2e5a67711",measurementId:"G-6BFEZXMG57"}),l=t(s),d=i(s,"tracenfind"),c={currentUser:null},u={sidebar:document.getElementById("sidebar"),sidebarToggle:document.getElementById("sidebarToggle"),mobileMenuToggle:document.getElementById("mobileMenuToggle"),mainContent:document.querySelector(".main-content"),themeToggle:document.getElementById("themeToggle"),userMenuToggle:document.getElementById("userMenuToggle"),userMenu:document.getElementById("userMenu"),userAvatarDisplays:document.querySelectorAll(".user-avatar-display"),userNameDisplays:document.querySelectorAll(".user-name-display"),userEmailDisplay:document.getElementById("userEmail"),logoutButtons:document.querySelectorAll(".logout-button"),preloader:document.getElementById("app-preloader"),toastContainer:document.getElementById("toastContainer")};function m(){window.location.replace(`${location.origin}/public/auth/login.html`)}async function g(){try{await n(l)}catch(e){console.error("Logout Error:",e)}finally{m()}}function b(){const e="dark"===document.documentElement.getAttribute("data-theme")?"light":"dark";p(e),localStorage.setItem("theme",e)}function p(e){document.documentElement.setAttribute("data-theme",e),document.documentElement.classList.toggle("dark","dark"===e);const t=u.themeToggle.querySelector("i");t&&(t.className="dark"===e?"bi bi-sun-fill":"bi bi-moon-fill"),window.dispatchEvent(new CustomEvent("themeChanged",{detail:{theme:e}}))}function f(){const e=u.sidebar.classList.toggle("sidebar-mini");localStorage.setItem("adminSidebarMini",e),h(e)}function h(e){const t=u.sidebarToggle.querySelector("i");e&&window.innerWidth>=1024?(u.sidebar.classList.add("sidebar-mini"),t&&(t.className="bi bi-chevron-bar-right")):(u.sidebar.classList.remove("sidebar-mini"),t&&(t.className="bi bi-chevron-bar-left")),setTimeout(()=>window.dispatchEvent(new Event("appResize")),300)}!function(){try{a(l,e=>{e?async function(e){const t=o(d,"user_data",e.uid,"profile","settings");try{const a=await r(t);a.exists()&&"admin"===a.data().role?(window.currentUserId=e.uid,window.currentUserIsAdmin=!0,c.currentUser={...e,...a.data()},function(e,t){(function(e,t){const a=t.fullName||e.displayName||"Admin",n=e.email||"admin@tracenfind.com",i=e.photoURL||`https://ui-avatars.com/api/?name=${encodeURIComponent(a)}&background=4361ee&color=fff&size=40`;u.userNameDisplays.forEach(e=>e.textContent=a),u.userAvatarDisplays.forEach(e=>e.src=i),u.userEmailDisplay&&(u.userEmailDisplay.textContent=n)})(e,t),function(){u.sidebarToggle&&u.sidebarToggle.addEventListener("click",f);u.mobileMenuToggle&&u.mobileMenuToggle.addEventListener("click",()=>{u.sidebar.classList.add("open"),u.sidebar.classList.remove("-translate-x-full")});u.themeToggle&&u.themeToggle.addEventListener("click",b);u.userMenuToggle&&u.userMenuToggle.addEventListener("click",e=>{e.stopPropagation(),u.userMenu.classList.toggle("hidden")});u.logoutButtons.forEach(e=>e.addEventListener("click",g)),document.addEventListener("click",e=>{!u.userMenu||u.userMenu.contains(e.target)||u.userMenuToggle.contains(e.target)||u.userMenu.classList.add("hidden"),window.innerWidth<1024&&u.sidebar&&!u.sidebar.contains(e.target)&&!u.mobileMenuToggle.contains(e.target)&&(u.sidebar.classList.remove("open"),u.sidebar.classList.add("-translate-x-full"))})}();p(t.theme||localStorage.getItem("theme")||"light");h(localStorage.getItem("adminSidebarMini")==="true"),u.preloader&&(u.preloader.style.opacity="0",setTimeout(()=>u.preloader.style.display="none",300))}(e,a.data())):g()}catch(a){console.error("Auth Guard Error:",a),g()}}(e):m()})}catch(e){console.error("Critical Firebase Init Error:",e)}}();export{c as a,l as b,d as f};
